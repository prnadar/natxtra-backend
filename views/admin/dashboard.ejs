<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Natxtra - Dashboard</title>
    <%- include('partials/linkheader.ejs') %>
</head>

<body>
    <div class="admin-wrapper">
        <%- include('partials/sidebar.ejs') %>

            <div class="main-content">
                <%- include('partials/header.ejs', { pageTitle: 'Dashboard' }) %>

                    <div class="content-area">
                        <!-- Metrics Grid -->
                        <div class="metrics-grid">
                            <!-- Total Revenue -->
                            <div class="metric-card">
                                <div class="metric-header">
                                    <div class="metric-icon">
                                        <i class="fas fa-dollar-sign"></i>
                                    </div>
                                    <div class="metric-trend up">
                                        <i class="fas fa-arrow-up"></i> 12.5%
                                    </div>
                                </div>
                                <div class="metric-value">₹<%= typeof totalPaymentReceived !=='undefined' ?
                                        totalPaymentReceived.toLocaleString() : '0' %>
                                </div>
                                <div class="metric-label">Total Revenue</div>
                            </div>

                            <!-- Total Orders -->
                            <div class="metric-card">
                                <div class="metric-header">
                                    <div class="metric-icon">
                                        <i class="fas fa-shopping-cart"></i>
                                    </div>
                                    <div class="metric-trend up">
                                        <i class="fas fa-arrow-up"></i> 8.2%
                                    </div>
                                </div>
                                <div class="metric-value">
                                    <%= typeof totalOrdersCount !=='undefined' ? totalOrdersCount : '0' %>
                                </div>
                                <div class="metric-label">Total Orders</div>
                            </div>

                            <!-- Pending Orders -->
                            <div class="metric-card">
                                <div class="metric-header">
                                    <div class="metric-icon">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                    <div class="metric-trend up">
                                        <i class="fas fa-arrow-up"></i> 3.1%
                                    </div>
                                </div>
                                <div class="metric-value">
                                    <%= typeof pendingOrdersCount !=='undefined' ? pendingOrdersCount : '0' %>
                                </div>
                                <div class="metric-label">Pending Orders</div>
                            </div>

                            <!-- Total Users -->
                            <div class="metric-card">
                                <div class="metric-header">
                                    <div class="metric-icon">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <div class="metric-trend up">
                                        <i class="fas fa-arrow-up"></i> 15.3%
                                    </div>
                                </div>
                                <div class="metric-value">
                                    <%= typeof totalUsersCount !=='undefined' ? totalUsersCount : '0' %>
                                </div>
                                <div class="metric-label">Total Users</div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Row -->
                    <div
                        style="display: grid; grid-template-columns: 2fr 1fr; gap: var(--space-6); margin-bottom: var(--space-8);">
                        <!-- Sales Chart -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Sales Overview</h3>
                                <div class="card-actions">
                                    <button class="btn btn-ghost btn-sm">
                                        <i class="fas fa-download"></i> Export
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <canvas id="salesChart" height="80"></canvas>
                            </div>
                        </div>

                        <!-- Top Products -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Top Products</h3>
                            </div>
                            <div class="card-body">
                                <div style="display: flex; flex-direction: column; gap: var(--space-4);">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <div style="font-weight: 600; color: var(--text-primary);">Diabetic Care
                                                Plus</div>
                                            <div style="font-size: 0.75rem; color: var(--text-muted);">156 sales
                                            </div>
                                        </div>
                                        <span class="badge badge-success">₹12,450</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <div style="font-weight: 600; color: var(--text-primary);">Immunity
                                                Booster</div>
                                            <div style="font-size: 0.75rem; color: var(--text-muted);">142 sales
                                            </div>
                                        </div>
                                        <span class="badge badge-success">₹10,890</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <div style="font-weight: 600; color: var(--text-primary);">Wellness
                                                Capsules</div>
                                            <div style="font-size: 0.75rem; color: var(--text-muted);">128 sales
                                            </div>
                                        </div>
                                        <span class="badge badge-success">₹9,560</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Orders Table -->
                    <div class="table-container">
                        <div class="table-header">
                            <h3 style="font-size: 1.125rem; font-weight: 600; color: var(--text-primary);">Recent
                                Orders</h3>
                            <a href="/admin/oerder-all" class="btn btn-primary btn-sm">View All</a>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Order ID</th>
                                    <th>Customer</th>
                                    <th>Product</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% if (typeof orders !=='undefined' && orders.length> 0) { %>
                                    <% orders.slice(0, 5).forEach(order=> { %>
                                        <tr>
                                            <td>#<%= order._id.toString().slice(-6).toUpperCase() %>
                                            </td>
                                            <td>
                                                <%= order.user_id ? order.user_id.name || 'N/A' : 'N/A' %>
                                            </td>
                                            <td>
                                                <%= order.product_id ? order.product_id.name || 'N/A' : 'N/A' %>
                                            </td>
                                            <td>₹<%= order.price || 0 %>
                                            </td>
                                            <td>
                                                <% if (order.status==='delivered' || order.status==='shifted' ) { %>
                                                    <span class="badge badge-success">Delivered</span>
                                                    <% } else if (order.status==='pending' ) { %>
                                                        <span class="badge badge-warning">Pending</span>
                                                        <% } else if (order.status==='process' ) { %>
                                                            <span class="badge badge-info">Processing</span>
                                                            <% } else { %>
                                                                <span class="badge badge-danger">
                                                                    <%= order.status %>
                                                                </span>
                                                                <% } %>
                                            </td>
                                            <td>
                                                <%= order.createdAt ? new
                                                    Date(order.createdAt).toLocaleDateString('en-IN', { year: 'numeric'
                                                    , month: 'short' , day: 'numeric' }) : 'N/A' %>
                                            </td>
                                        </tr>
                                        <% }); %>
                                            <% } else { %>
                                                <tr>
                                                    <td colspan="6"
                                                        style="text-align: center; color: var(--text-muted); padding: var(--space-8);">
                                                        No orders found
                                                    </td>
                                                </tr>
                                                <% } %>
                            </tbody>
                        </table>
                    </div>
            </div>
    </div>
    </div>

    <%- include('partials/linkfooter.ejs') %>

        <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
        <script>
            // Sales Chart
            const ctx = document.getElementById('salesChart');
            if (ctx) {
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                        datasets: [{
                            label: 'Sales',
                            data: [12000, 19000, 15000, 25000, 22000, 30000, 28000, 35000, 32000, 40000, 38000, 45000],
                            borderColor: '#34D399',
                            backgroundColor: 'rgba(52, 211, 153, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.05)'
                                },
                                ticks: {
                                    color: '#64748B'
                                }
                            },
                            x: {
                                grid: {
                                    color: 'rgba(255, 255, 255, 0.05)'
                                },
                                ticks: {
                                    color: '#64748B'
                                }
                            }
                        }
                    }
                });
            }
        </script>
</body>

</html>